###############################################################################
#### executable program's name ################################################
NAME = webserv

###############################################################################
#### path and variables #######################################################
###############################################################################

SRC_DIR = ./src/
OBJ_DIR = ./obj/
HEADER_DIR = ./inc/

CC = c++
CFLAGS = -Wall -Wextra -Werror -std=c++98 -g3
RM = rm -f

GREEN = \033[0;32m
BOLD = \033[1m
RESET = \033[0;m

########### source files and objects ##########################################
###############################################################################

SRC_FILES = main.cpp Server.cpp signal_handler.cpp config_parser.cpp tokenizer.cpp utils.cpp

OBJ = $(addprefix $(OBJ_DIR), $(SRC_FILES:.cpp=.o))

HEADER = -I$(HEADER_DIR)

#### rule by default ##########################################################
###############################################################################
all: $(NAME)

#### create objects (.o) from source files (.c) ###############################
###############################################################################

$(OBJ_DIR)%.o: $(SRC_DIR)%.cpp 
	@mkdir -p $(OBJ_DIR)
	@$(CC) $(CFLAGS) $(HEADER) -c $< -o $@

#### linking objects in executable ############################################
###############################################################################

$(NAME): $(OBJ)
	@$(CC) $(CFLAGS) $(HEADER) $(OBJ) -o $(NAME)
	@echo "$(BOLD)$(GREEN)Compilation of $(NAME) is done$(RESET)"

#### clean objects ############################################################

clean:
	@$(RM) -r $(OBJ_DIR)/*.o
	@$(RM) -fr $(OBJ_DIR)

#### clean objects and executable #############################################

fclean: clean
	@$(RM) $(NAME)

###############################################################################

re: fclean all

.PONY: all clean fclean re

###############################################################################